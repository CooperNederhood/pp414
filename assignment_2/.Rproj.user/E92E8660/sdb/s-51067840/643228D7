{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Assignment 1\"\nauthor: \"Xiangyu Ma\"\ndate: \"10/10/2018\"\noutput: pdf_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(\n  include = FALSE,\n  options(digits = 3))\n```\n\n```{r}\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(MASS)\nlibrary(sem)\nset.seed(47)\n```\n\n\n\n```{r}\ndf <- read_csv(\"JTPA.csv\")\n```\n# Question 1\n\n## 1.\n\n```{r}\ndf$expstat2 <- cut(df$expstat, breaks = 2, labels = c(\"Not assigned\", \"Assigned\"), ordered_result =  TRUE)\ndf$treated2 <- cut(df$treated, breaks = 2, labels = c(\"Untreated\", \"Treated\"), ordered_result =  TRUE)\ncont1 <- table(df$expstat2, df$treated2)\n```\n\n\n```{r, include = TRUE, echo= FALSE}\nkable(cont1, caption = \"Contingency table of Assignment X Treatment\")\n```\n\nWe can observe from Table 1 that there is substantial crossover between the two. 307 of individuals who were assigned to the control group were treated anyway; 647 of those assigned treatment did not receive treatment.\n\nWe can run a logistic regression with the treatment status as the dependent variable, and all of the observable variables as the independent variable. Observable variables that correlate with treatment status are not balanced between the two groups.\n\n## 2.\n\n```{r}\nassigned <- filter(df, expstat == 1)\nunassigned <- filter(df, expstat == 0)\nitt_est <- mean(assigned$emp) - mean(unassigned$emp)\n```\n\nThe ITT parameter without covariate is $`r itt_est`$.\n\n## 3. \n\n```{r}\npc <- mean(assigned$treated) - mean(unassigned$treated)\nbloom <- itt_est/pc\nbloom\nitt_est\n```\n\nThe Bloom estimand without covariates is $`r bloom`$.\n\n## 4.\n\n```{r}\nnames(df)\n```\n\n\n```{r}\nlm1 <- lm(emp ~ expstat + afdc_ra + badenglh + fdst_ra + ged + kids + kidsud4 + longafdc + married + minor02 + minor03 + minor04 + neveradc + neverwrk + nodegree + single + numinhh + schlhgst + agesq + pre12ern + pre12wrk + age, data = df)\n```\n\n```{r}\nsummary(lm1)\n```\n\n\n```{r}\n\n```\n\n\n```{r}\niv_bloom <- tsls(emp ~ treated, \n                 ~expstat, \n                 df)\n\niv_bloom2 <- tsls(emp ~ treated + afdc_ra + badenglh + fdst_ra + ged, \n                  ~expstat + afdc_ra + badenglh + fdst_ra + ged, \n                  df)\nsummary(iv_bloom2)\n```\n\n```{r}\n0.03662/pc\n```\n\n\n```{r}\ntdf <- lm(emp ~ expstat + afdc_ra + badenglh + fdst_ra + ged,df)\nsummary(tdf)\n```\n\n```{r}\ntlm3 <- lm(treated~expstat, assigned)\nsummary(tlm3)\n```\n\n\n```{r}\ntlm1 <- lm(emp~expstat2, assigned)\ntlm2 <- lm(emp~expstat2, unassigned)\ntlm3 <- lm(treated~expstat2, unassigned)\n```\n\n\n\n\n```{r}\nsummary(iv_bloom)\n\nsummary(iv_bloom2)\n```\n\n # make a table of standard errors.\n\n\n## 5. \n\nThere's the issue of multicollinearity as we add in more and more covariates (that are likely to be highly correlated with one another). This leads to higher standard errors, and increases the likelihood of us making type II errors, where we accept a null hypothesis falsely.\n\n# Question 2.\n\n## 1.\n\n```{r}\n# generate a bivariate normal distribution\ndistr1 <- mvrnorm(1000, c(0, 0), matrix(c(10000^2, 0, 0 , 20000^2),2))\ncolnames(distr1) <- c(\"no_college\",\"college\")\n\nq2 <- as.data.frame(distr1)\nwrite_csv(q2, \"generated_data.csv\")\n\nq2 <- read_csv(\"generated_data.csv\") %>%\n  mutate(college_income = 50000 + college) %>%\n  mutate(noncollege_income = 40000 + no_college)%>%\n  mutate(decision = ifelse(college_income>noncollege_income, 1, 0))\n\nq1ans <- count(q2, decision)\n```\n\n\n$`r q1ans$n[q1ans$decision==1]/1000*100`$% of people went to college.\n\n\n## 2.\n\n```{r}\nq2 <- mutate(q2, observed_income =  ifelse(decision == 1, college_income, noncollege_income))\n```\n\n\n```{r}\n# naive estimator\nq2_col <- filter(q2, decision == 1)\nq2_hs <-filter(q2, decision == 0)\n\nnaive_estimate <- mean(q2_col$observed_income) - mean(q2_hs$observed_income)\n```\n\nThe \"naive\" estimate of the effects of obtaining a college degree on earnings is $`r naive_estimate`$.\n\n## 3.\n\n```{r}\nq2 <- mutate(q2, treatment_effect = college_income - noncollege_income)\nate <- mean(q2$treatment_effect)\n```\n\nThis gives us an Average Treatment Effect (ATE) of `r ate`. We can see that the ATE is smaller than the naive estimate. This is because the naive estimate certain (false) assumptions about the data, it assumes that treatment is random, that those who are untreated can serve as the counterfactual to those who were treated. In reality, however, this does not hold. This leads to a selection bias. Since we generated the data ourselves, we know what the self-selection process is, and we know that it's non-random: we assume that a student goes to college if his/her earnings are higher as a college student. This leads to a positive selection bias, and correspondingly to an overestimate on the part of the naive estimate.\n\n## 4. \n\n```{r}\ntemp1 <- filter(q2, decision == 1) \ntemp2 <- filter(q2, decision == 0) \natt <- mean(temp1$treatment_effect)\natn <- mean(temp2$treatment_effect)\n```\n\nThe Average effect of Treatment on the Treated (ATT) is $`r att`$, and the the Average effect of Treatment on the Non-treated (ATN) is $`r atn`$. The consequences of such a policy may be undesirable in our world (I say \"may,\" because there may be non-income benefits to a college education.) We can observe from the ATN that a \"college-for-all\" situation would lead to an average decrease in income of $`r atn`$. So, such a policy would harm these non-college educated individuals income-wise.\n\n## 5.\n```{r}\ncovariance_xy <- 0.6 * 10000 * 20000\n\n# generate another bivariate normal distribution\ndistr2 <- mvrnorm(1000, c(0, 0), matrix(c(10000^2, covariance_xy, covariance_xy , 20000^2),2))\ncolnames(distr2) <- c(\"no_college\",\"college\")\n\nq2b <- as.data.frame(distr2)\nwrite_csv(q2b, \"generated_data2.csv\")\n```\n\n\n```{r}\nq2b <- read_csv(\"generated_data2.csv\")\n\nq2b <- mutate(q2b, college_income = 50000 + college) %>%\n  mutate(noncollege_income = 40000 + no_college) \n\nq2b <- mutate(q2b, decision = ifelse(college_income>noncollege_income, 1, 0))\n\n```\n\n```{r}\nq5ans <- count(q2b, decision)\n```\n\n```{r}\nq5ans$n[q5ans$decision==1]/1000*100\n```\n\n\n$`r q5ans$n[q5ans$decision==1]/1000*100`$% of people will go to college in this scenario. This is more than before. \n\n```{r}\nq2b <- mutate(q2b, observed_income =  ifelse(decision == 1, college_income, noncollege_income))\n\n# naive estimator\nq2b_col <- filter(q2b, decision == 1)\nq2b_hs <-filter(q2b, decision == 0)\n\nnaive_estimate2 <- mean(q2b_col$observed_income) - mean(q2b_hs$observed_income)\n\nq2b <- mutate(q2b, treatment_effect = college_income - noncollege_income)\nate2 <- mean(q2b$treatment_effect)\n```\n\nIn the new scenario, we have an naive estimate of  $`r naive_estimate2`$ and an ATE of $`r ate2`$.\n\n## 6.\n  \n```{r}\ncovariance_xy <- -0.5 * 10000 * 20000\n\n# generate another bivariate normal distribution\ndistr3 <- mvrnorm(1000, c(0, 0), matrix(c(10000^2, covariance_xy, covariance_xy , 20000^2),2))\ncolnames(distr3) <- c(\"no_college\",\"college\")\n\nq2c <- as.data.frame(distr3)\nwrite_csv(q2c, \"generated_data3.csv\")\n\nq2c <- read_csv(\"generated_data3.csv\")\n\nq2c <- mutate(q2c, college_income = 50000 + college) %>%\n  mutate(noncollege_income = 40000 + no_college) \n\nq2c <- mutate(q2c, decision = ifelse(college_income>noncollege_income, 1, 0))\n\nq6ans <- count(q2c, decision)\n\nq2c <- mutate(q2c, observed_income =  ifelse(decision == 1, college_income, noncollege_income))\n\n# naive estimator\nq2c_col <- filter(q2c, decision == 1)\nq2c_hs <-filter(q2c, decision == 0)\n\nnaive_estimate3 <- mean(q2c_col$observed_income) - mean(q2c_hs$observed_income)\n\nq2c <- mutate(q2c, treatment_effect = college_income - noncollege_income)\nate3 <- mean(q2c$treatment_effect)\n```\n\nIn the final scenario, we have an naive estimate of  $`r naive_estimate3`$ and an ATE of $`r ate3`$.\n\n```{r}\nnaive_estimate2\nnaive_estimate3\nate2\nate3\n```\n\n",
    "created" : 1540783620227.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3304347000",
    "id" : "643228D7",
    "lastKnownWriteTime" : 1540232220,
    "last_content_update" : 1540232220,
    "path" : "~/Documents/research_projects/pp414_applied_regression_analysis/assignment_1/assignment_1.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}